---
format: pdf 
output: 
  pdf_document: 
  latex_engine: xelatex
---

```{r, include = FALSE}
# Global settings to hide code and results in the final document
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, results='hide')
```

```{r}
library(pacman)
p_load(openintro, tidyverse,dplyr,tidyr)

```

```{r}
 data("reddit_finance")
```

```{r}
# Cleaning data and selecting relevant columns for predictive modeling
# First, We created the reddit_finance dataset for easier work. 
reddit_finance_sub <- reddit_finance 

# Then, we create new variables that allow us to use the current variables in our model.

# We will make some assumptions and decision rules based on criteria to clean our dataset, which we will detail in the following code:

# 1. num_incomes: 
# How many individuals contribute to your household income?
# We have 1 record with NA, which we will replace with 0, and 2 records with n > 3, which we will replace with 4.


reddit_finance_sub$num_incomes <- ifelse(is.na(reddit_finance_sub$num_incomes), 0, reddit_finance_sub$num_incomes)

reddit_finance_sub$num_incomes <- ifelse(reddit_finance_sub$num_incomes == ">3", 4, reddit_finance_sub$num_incomes)


reddit_finance_sub$num_incomes <- as.numeric(reddit_finance_sub$num_incomes)

# 2. pan_inc_chg
# As a result of the pandemic, did your earned income increase, decrease, or remain the same?

reddit_finance_sub$pan_inc_chg <- factor(reddit_finance_sub$pan_inc_chg, levels = c( "Decreased","Stayed the same","Increased"))

# 3. pan_inc_chg_pct
# By how much did your earned income change?
# For this variable, we apply the decision rule of replacing the intervals with their central number. For example, the interval 1-10% will be replaced by 5%, 11-20% by 15%, and so on.

reddit_finance_sub <- reddit_finance_sub %>%
  mutate(pan_inc_chg_pct = case_when(
    pan_inc_chg_pct == "1-10%"  ~ 0.05,
    pan_inc_chg_pct == "11-20%" ~ 0.15,
    pan_inc_chg_pct == "21-30%" ~ 0.25,
    pan_inc_chg_pct == "31-40%" ~ 0.35,
    pan_inc_chg_pct == "41-50%" ~ 0.45,
    pan_inc_chg_pct == "51-60%" ~ 0.55,
    pan_inc_chg_pct == "61-70%" ~ 0.65,
    pan_inc_chg_pct == "71-80%" ~ 0.75,
    pan_inc_chg_pct == "81-90%" ~ 0.85,
    pan_inc_chg_pct == "91-100%" ~ 0.95,
    pan_inc_chg_pct == "No change" ~ 0,
    TRUE ~ as.numeric(pan_inc_chg_pct)  
  ))


reddit_finance_sub$pan_inc_chg_pct <- as.numeric(reddit_finance_sub$pan_inc_chg_pct)

# 4.pan_exp_chg
# As a result of the pandemic, did your expenses increase, decrease, or remain the same?

reddit_finance_sub$pan_exp_chg <- factor(reddit_finance_sub$pan_exp_chg, levels = c( "Decreased","Stayed the same", "Increased"))

# 5.pan_exp_chg_pct
# By how much did your expenses change?
# For this variable, we apply the decision rule of replacing the intervals with their central number. For example, the interval 1-10% will be replaced by 5%, 11-20% by 15%, and so on.

reddit_finance_sub <- reddit_finance_sub %>%
  mutate(pan_exp_chg_pct = case_when(
    pan_exp_chg_pct == "1-10%"  ~ 0.05,
    pan_exp_chg_pct == "11-20%" ~ 0.15,
    pan_exp_chg_pct == "21-30%" ~ 0.25,
    pan_exp_chg_pct == "31-40%" ~ 0.35,
    pan_exp_chg_pct == "41-50%" ~ 0.45,
    pan_exp_chg_pct == "51-60%" ~ 0.55,
    pan_exp_chg_pct == "61-70%" ~ 0.65,
    pan_exp_chg_pct == "71-80%" ~ 0.75,
    pan_exp_chg_pct == "81-90%" ~ 0.85,
    pan_exp_chg_pct == "91-100%" ~ 0.95,
    pan_exp_chg_pct == "No change" ~ 0,
    TRUE ~ as.numeric(pan_exp_chg_pct)  
  ))


reddit_finance_sub$pan_exp_chg_pct <- as.numeric(reddit_finance_sub$pan_exp_chg_pct)

# 6. pan_fi_chg
# As a result of the pandemic, did your FI (financially independent) number...

reddit_finance_sub$pan_fi_chg <- factor(reddit_finance_sub$pan_fi_chg, levels = c( "Decrease","No change", "Increase"))

# 7.pan_ret_date_chg
# As a result of the pandemic, did your planned RE (retirement) date...

reddit_finance_sub$pan_ret_date_chg <- factor(reddit_finance_sub$pan_ret_date_chg, levels = c( "Become later", "No change", "Become sooner"))

# 8. pan_financial_impact
#Overall, how would you characterize the pandemic's impact on your finances?

reddit_finance_sub$pan_financial_impact <- factor(reddit_finance_sub$pan_financial_impact, levels = c( "Negative", "Neutral", "Positive"))

# 9. political
# With which political party do you most closely identify? You do not need to be registered with a party to select it, answer based on your personal views.


reddit_finance_sub <- reddit_finance_sub %>%
  mutate(political_grouped = case_when(
    political %in% c("Democrat", "Libertarian Party", "Republican") ~ as.character(political),
    TRUE ~ "Other"
  ))

reddit_finance_sub$political_grouped <- as.factor(reddit_finance_sub$political_grouped)

# 10. race_eth
# What is your race/ethnicity? Select all that apply.

reddit_finance_sub <- reddit_finance_sub %>%
  mutate(race_eth_grouped = case_when(
    race_eth %in% c("N/A", "NA", "Decline to state") ~ NA_character_,
    TRUE ~ as.character(race_eth)
  ))

reddit_finance_sub$race_eth_grouped <- as.factor(reddit_finance_sub$race_eth_grouped)

# 11. gender
# What is your gender?


reddit_finance_sub <- reddit_finance_sub %>%
  mutate(gender_grouped = case_when(
    tolower(gender) %in% c("decline to state", "n/a", "na") ~ NA_character_,
    tolower(gender) %in% c("non-binary") ~ "Non-Binary",
    TRUE ~ as.character(gender)
  ))

reddit_finance_sub$gender_grouped <- as.factor(reddit_finance_sub$gender_grouped)


# 12 age
# What is your age?
# For this variable, we apply the decision rule of replacing the intervals with their central number. For example, the interval 18-23 will be replaced by 21, 24-28 by 26, and so on.
reddit_finance_sub <- reddit_finance_sub %>%
  mutate(age = case_when(
    age %in% c("<18", "N/A", "NA") ~ NA_real_,
    age == "18-23" ~ 21,
    age == "24-28" ~ 26,
    age == "29-33" ~ 31,
    age == "34-38" ~ 36,
    age == "39-43" ~ 41,
    age == "44-48" ~ 46,
    age == "49-53" ~ 51,
    age == "54-58" ~ 56,
    age == "59-63" ~ 61,
    TRUE ~ as.numeric(age)
  ))

reddit_finance_sub$age <- as.numeric(reddit_finance_sub$age)

# 13. edu
# What is the highest level of education you have completed?
#"For the case of the education variable, we grouped its values into broader categories."


reddit_finance_sub <- reddit_finance_sub %>%
  mutate(edu_grouped = case_when(
    edu %in% c("High School diploma / GED", "Less than high school", "Some high school") ~ "High School or Less",
    edu %in% c("Some college, no degree", "Trade School Degree") ~ "Some College or Trade School",
    edu %in% c("Associate's Degree", "Bachelor's Degree") ~ "Bachelor's or Associate's Degree",
    edu %in% c("Doctorate / Post Graduate", "Doctorate / Post-Graduate", "Graduate degree") ~ "Doctorate or Master's Degree",
    edu %in% c("N/A", "NA") ~ NA_character_,
    TRUE ~ as.character(edu)
  ))


edu_levels <- c("High School or Less", "Some College or Trade School", "Bachelor's or Associate's Degree",   "Doctorate or Master's Degree")
reddit_finance_sub$edu_grouped <- factor(reddit_finance_sub$edu_grouped, levels = edu_levels)


# 14. rel_status
# What is your relationship status?
 
reddit_finance_sub <- reddit_finance_sub %>%
  mutate(rel_status_grouped = case_when(
    rel_status %in% c("Divorced", "Widowed", "Single, never married") ~ "Singles",
    rel_status %in% c("Divorced - Remarried", "In a relationship, but not married", "Married", "Widowed - Remarried") ~ "In a Relationship",
    rel_status %in% c("N/A", "NA") ~ NA_character_,
    TRUE ~ as.character(rel_status)
  )) %>%
  mutate(rel_status_grouped = as.factor(rel_status_grouped))

# 15. children
# Do you have children?


reddit_finance_sub <- reddit_finance_sub %>%
  mutate(children_grouped = case_when(
    children %in% c("Do not have children, and do not intend to", "Do not have children, but intend to") ~ "No Children",
    children %in% c("Have children") ~ "Have Children",
    children %in% c("N/A", "NA") ~ NA_character_,
    TRUE ~ as.character(children)
  )) %>%
  mutate(children_grouped = as.factor(children_grouped))

# 16. country
# What country are you in?

reddit_finance_sub <- reddit_finance_sub %>%
  mutate(country_grouped = case_when(
    country %in% c("United States") ~ "United States",
    TRUE ~ "Other"
  )) %>%
  mutate(country_grouped = as.factor(country_grouped))

# 17. fin_indy
# Are you financially independent? Meaning you do not need to work for money, regardless of whether you work for money.

reddit_finance_sub$fin_indy <- ifelse(reddit_finance_sub$fin_indy == "Yes", 1, 0)


# 18. fin_indy_num
# At what amount invested will you consider yourself Financially Independent? (What is your FI number?)
reddit_finance_sub$fin_indy_num <- as.numeric(reddit_finance_sub$fin_indy_num)

# 19. fin_indy_pct
# What percent FI are you? (What percent of your FI number do you currently have?)
# While exploring this dataset, there are certain outlier values that appear to be errors, such as individuals who have 95000, 2.00E+05, 260000, 4800000 percent of their FI number. Therefore, we will replace these values with NA to avoid distorting our distribution of this variable

reddit_finance_sub <- reddit_finance_sub %>%
  mutate(
    fin_indy_pct = as.numeric(fin_indy_pct),  
    fin_indy_pct = ifelse(fin_indy_pct > 1000, NA_real_, fin_indy_pct)  
  )


# 25 fin_indy_lvl
# Which of the following would you have considered yourself at the time you reached Financial Independence:

reddit_finance_sub <- reddit_finance_sub %>%
  mutate(
    fin_indy_lvl = case_when(
      fin_indy_lvl == "Don't understand" ~ NA_character_,
      TRUE ~ fin_indy_lvl
    ),
    fin_indy_lvl = as.factor(fin_indy_lvl)
  )

# 26. retire_age
# At what age do you intend to retire?
# For this variable, we apply the decision rule of replacing the intervals with their central number. For example, the interval 18-23 will be replaced by 21, 24-28 by 26, and so on.
reddit_finance_sub <- reddit_finance_sub %>%
  mutate(retire_age = case_when(
    retire_age %in% c("Undecided") ~ NA_real_,
    retire_age == "24-28" ~ 26,
    retire_age == "29-33" ~ 31,
    retire_age == "34-38" ~ 36,
    retire_age == "39-43" ~ 41,
    retire_age == "44-48" ~ 46,
    retire_age == "49-53" ~ 51,
    retire_age == "54-58" ~ 56,
    retire_age == "59-63" ~ 61,
    retire_age == "64-68" ~ 66,
    retire_age == "69+" ~ 71,
    TRUE ~ as.numeric(retire_age)
  ))


# 27. stp_whn_fin_indy
# Do you intend to stop working for money when you reach financial independence?

reddit_finance_sub$stp_whn_fin_indy <- as.factor(reddit_finance_sub$stp_whn_fin_indy)


# 28. industry
# Which of the following best describes the industry in which you currently or most recently work(ed)?
# After analyzing the distribution of industries in our dataset, we will group industries with lower frequency into 'Other Services'

reddit_finance_sub$industry_grouped <- as.factor(ifelse(
  reddit_finance_sub$industry %in% c(
    "Other Services", "Military", "Transportation",
    "Natural Resources", "Arts, Entertainment, Recreation",
    "Utilities", "Trade, transportation, utilities",
    "Agriculture, Forestry, Fishing", "Media", "Real Estate",
    "Leisure & Hospitality", "NA"
  ),
  "Other Services",
  reddit_finance_sub$industry
))


# 29. employer
# Which of the following best describes your current or most recent employer?
reddit_finance_sub$employer <- as.factor(reddit_finance_sub$employer)

# 30 role
# Which of the following best describes your current or most recent job role?
reddit_finance_sub$role <- as.factor(reddit_finance_sub$role)

# 31 ft_status
# What is your current employment status? - Full Time

reddit_finance_sub$ft_status <- ifelse(
  reddit_finance_sub$ft_status %in% c("N/A", "NA", "For an Organization (Employed), For Myself (Self-Employed)"),
  NA_character_,
  reddit_finance_sub$ft_status
)

reddit_finance_sub$ft_status <- as.factor(reddit_finance_sub$ft_status)


# 32. pt_status
# What is your current employment status? - Part Time, Regular

reddit_finance_sub$pt_status <- ifelse(
  reddit_finance_sub$pt_status %in% c("N/A", "NA", "For an Organization (Employed), For Myself (Self-Employed)"),
  NA_character_,
  reddit_finance_sub$pt_status
)

reddit_finance_sub$pt_status <- as.factor(reddit_finance_sub$pt_status)

# 33 gig_status
# What is your current employment status? -Side Gig, Intermittent

reddit_finance_sub$gig_status <- ifelse(
  reddit_finance_sub$gig_status %in% c("N/A", "NA", "For an Organization (Employed), For Myself (Self-Employed)"),
  NA_character_,
  ifelse(reddit_finance_sub$gig_status %in% c("For Myself (Self-Employed), N/A"), "For Myself (Self-Employed)", reddit_finance_sub$gig_status)
)

reddit_finance_sub$gig_status <- as.factor(reddit_finance_sub$gig_status)

# 34. ne_status
# What is your current employment status? -Not Employed

#It is decided to eliminate the variable 'ne_status' as it does not seem to make much sense. The question initially refers to people without employment, but later, in the responses, the type of employer is mentioned. Given this situation, it would be difficult to interpret.

# 35 edu_status
# What is your current educational status?

reddit_finance_sub$edu_status <- ifelse(reddit_finance_sub$edu_status %in% c("Full time student", "Part time student"), "Student", "Not a student")

reddit_finance_sub$edu_status <- as.factor(reddit_finance_sub$edu_status)


# 36 housing
# What is your current housing situation?
reddit_finance_sub$housing <- ifelse(
  reddit_finance_sub$housing %in% c("Live with family or friends", "Own", "Rent"),
  reddit_finance_sub$housing,
  "Other"
)

reddit_finance_sub$housing <- as.factor(reddit_finance_sub$housing)

# 24, 37 - 65 
# For the income and expense variables, we will assume that missing values (NAs) indicate when a person has no expenses in that category. In such cases, we will consider these missing values to have a value of 0.

variables_to_replace <- c(
  "whn_fin_indy_num",
  "home_value",
  "brokerage_accts_tax",
  "retirement_accts_tax",
  "cash",
  "invst_accts",
  "spec_crypto",
  "invst_prop_bus_own",
  "other_val",
  "student_loans",
  "mortgage",
  "auto_loan",
  "credit_personal_loan",
  "medical_debt",
  "invst_prop_bus_own_debt",
  "other_debt",
  "2020_gross_inc",
  "2020_housing_exp",
  "2020_utilities_exp",
  "2020_transp_exp",
  "2020_necessities_exp",
  "2020_lux_exp",
  "2020_child_exp",
  "2020_debt_repay",
  "2020_invst_save",
  "2020_charity",
  "2020_healthcare_exp",
  "2020_taxes",
  "2020_edu_exp",
  "2020_other_exp"
)

# Replace NAs with 0 in the specified variables
reddit_finance_sub <- reddit_finance_sub %>%
  mutate_at(vars(variables_to_replace), list(~replace_na(., 0)))

# Deleting outliers
reddit_finance_sub <- reddit_finance_sub %>%
  mutate(cash = ifelse(cash >= 4500000.00, NA, cash))

#"Since there are many variables related to income or assets, debts, and expenses, we will create 3 variables that sum these individual items: total_debts, total_assets, and total_expenses

#total_assets
reddit_finance_sub <- reddit_finance_sub %>%
  mutate(total_assets = rowSums(select(., 
    c("home_value","brokerage_accts_tax","retirement_accts_tax","cash","invst_accts","spec_crypto","invst_prop_bus_own","other_val"))))

#total_debts
reddit_finance_sub <- reddit_finance_sub %>%
  mutate(total_debts = rowSums(select(., 
    c("student_loans","mortgage","auto_loan","credit_personal_loan","medical_debt","invst_prop_bus_own_debt","other_debt"))))

#total_expenses
reddit_finance_sub <- reddit_finance_sub %>%
  mutate(total_expenses = rowSums(select(., 
    c("2020_housing_exp", "2020_utilities_exp", "2020_transp_exp", "2020_necessities_exp", "2020_lux_exp", "2020_child_exp","2020_debt_repay", "2020_charity", "2020_healthcare_exp","2020_taxes", "2020_edu_exp", "2020_other_exp"))))

# We finally removed some previously transformed variables that we will not be using in their original form.
reddit_finance_sub <- reddit_finance_sub[, !(names(reddit_finance_sub) %in% c("political", "race_eth", "gender", "edu", "rel_status", "children","country", "industry","ne_status", "home_value","brokerage_accts_tax","retirement_accts_tax", "cash", "invst_accts","spec_crypto","invst_prop_bus_own","other_val","student_loans","mortgage","auto_loan","credit_personal_loan","medical_debt","invst_prop_bus_own_debt","other_debt","2020_housing_exp","2020_utilities_exp","2020_transp_exp","2020_necessities_exp","2020_lux_exp","2020_child_exp","2020_debt_repay","2020_charity","2020_healthcare_exp","2020_taxes","2020_edu_exp","2020_other_exp"))]
```

```{r}
logistic_mod <- glm(fin_indy ~ 
age
+political_grouped
+housing
+total_debts
+total_assets
+total_expenses
+`2020_gross_inc`
+`2020_invst_save`
  ,data=reddit_finance_sub,
  family="binomial")
summary(logistic_mod)
```

```{r}
# Supongamos que tu data frame se llama 'mi_data' y quieres guardarlo como un archivo CSV llamado 'mi_archivo.csv'
write.csv(reddit_finance_sub, file = "mi_archivo.csv", row.names = FALSE)

```

# Financial Independence Survey - Logistic Regression Model

## **Overview**

The objective of this project is to develop a Logistic Regression Model to address the Research Question:

**What factors contribute to an individual's perception of financial independence?**

To accomplish this objective, we will analyze a dataset that is a subset of the official results from the 2020 Financial Independence Survey on Reddit (r/financialindependence). This subset exclusively comprises responses from individuals representing themselves (excluding contributions from other household members) and excludes retired individuals. The dataset encompasses 1,998 rows and 65 variables, covering information such as income contributors, the financial impact of the pandemic, political affiliation, demographics, details about financial independence, employment status, and various financial aspects. The data has been sourced from Reddit.

For additional details regarding the data dictionary and source information, please refer to the [www.openintro.org](https://www.openintro.org/data/index.php?data=reddit_finance) website.

## **Data cleaning**

Which variables required cleaning? Are there any missing values? Did you make any assumptions during the data cleaning process?

A series of transformations was carried out during the data cleaning process of their 65 original variables, among which the following stand out:

-   Out of a total of 30 variables, which constituted numeric-type variables such as Children Expenses, Luxury Expenses, Transportation Expenses, Taxes, Medical Debt, etc., it was observed that they did not contain the number 0 but did have many NA (Not Available) values. The assumption was made that individuals who responded with 'NA' in fields such as Children Expenses did so because they had no associated expenses in that category. For this reason, in these 30 variables, NA values were replaced with 0.

-   

## **Modeling**

## **Results**

## **Future work**
